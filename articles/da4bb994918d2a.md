---
title: "ã€Rubyã€‘ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§Googleãƒ‰ãƒ©ã‚¤ãƒ–ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã¿ã‚‹"
emoji: "ğŸ¦”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Ruby", "Google"]
published: true
---

## ã¯ã˜ã‚ã«

API ã‚’å©ã„ã¦å…¥æ‰‹ã—ãŸç”»åƒã‚’ãã®ã¾ã¾ Google ãƒ‰ãƒ©ã‚¤ãƒ–ã«ä¿å­˜ã—ãŸã‹ã£ãŸã®ã§ã€Google API ã‚’ä½¿ã£ã¦ Ruby ã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ã¦ã¿ã¾ã—ãŸã€‚
ä»Šå›ã®è¨˜äº‹ã§ã¯ã€Google ãƒ‰ãƒ©ã‚¤ãƒ–ã«ä¿å­˜ã™ã‚‹éš›ã®äº‹å‰æº–å‚™ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ã¾ã¨ã‚ã¦ãŠãã¾ã™ã€‚

## ç’°å¢ƒ

Ruby 3.1.3

## äº‹å‰æº–å‚™

### Gem ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Google ãŒå…¬å¼ã§å‡ºã—ã¦ã„ã‚‹ä¸‹è¨˜ã® gem ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚
ãã‚Œãã‚Œ`gem install`ã—ã¦ãŠãã¾ã™ã€‚

- [REST client for Google APIs](https://github.com/googleapis/google-api-ruby-client)
- [Google Auth Library for Ruby](https://github.com/googleapis/google-auth-library-ruby)

### ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™

ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆã¯[ã“ã¡ã‚‰](https://support.google.com/a/answer/7378726?hl=ja)ã‚’å‚ç…§ãã ã•ã„ã€‚
ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆå¾Œã€ã‚­ãƒ¼ã‚’ç™ºè¡Œã—ã¦ JSON ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãŠãã¾ã™ã€‚
ã¾ãŸã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ãŸã„ Google ãƒ‰ãƒ©ã‚¤ãƒ–ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å…±æœ‰ã—ã¦ãŠãã¾ã™ã€‚

![ã‚­ãƒ¼ä½œæˆæ™‚ã®ç”»é¢](https://storage.googleapis.com/zenn-user-upload/7385d6c7f15e-20230419.png)

ã‚­ãƒ¼ä½œæˆæ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹æ³¨æ„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚
ä»Šå›ã¯ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã—ãŸãŒçŠ¶æ³ã«å¿œã˜ã¦ã€**Workload Identity**ã‚’ä½¿ã†æ–¹ãŒè‰¯ã•ãã†ã§ã™ã€‚
å¼•ç”¨å…ƒã§ã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹[ã“ã¡ã‚‰](https://cloud.google.com/blog/products/identity-security/how-to-authenticate-service-accounts-to-help-keep-applications-secure?hl=en&_ga=2.114883911.-1575122230.1681465231&_gac=1.180643413.1681897496.CjwKCAjwov6hBhBsEiwAvrvN6JN9MSx_YQH_-ZxYH8XNAVt6F7vGuMojqd0MPFpiNipIpKqaEFxs2hoCEG8QAvD_BwE)ã®ãƒšãƒ¼ã‚¸ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```ruby
require 'google/apis/drive_v3'
require 'googleauth'

scope = 'https://www.googleapis.com/auth/drive.file'
authorizer = Google::Auth::ServiceAccountCredentials.make_creds(
  json_key_io: File.open('./client_secret.json'),
  scope: scope)
authorizer.fetch_access_token!

drive = Google::Apis::DriveV3::DriveService.new
drive.authorization = authorizer

metadata = Google::Apis::DriveV3::File.new(name: 'sample.png', parents: ['Googleãƒ‰ãƒ©ã‚¤ãƒ–ã®ãƒ•ã‚©ãƒ«ãƒ€ID'])
drive.create_file(metadata, upload_source: './sample.png', content_type: 'image/png')
```

å€‹åˆ¥ã«èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

```ruby
scope = 'https://www.googleapis.com/auth/drive.file'
authorizer = Google::Auth::ServiceAccountCredentials.make_creds(
  json_key_io: File.open('./client_secret.json'),
  scope: scope)
authorizer.fetch_access_token!
```

**Google Auth Library for Ruby** ã®[Readme](<https://github.com/googleapis/google-auth-library-ruby#:~:text=to%20use%20credentials-,Example,-(Service%20Account)>)ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

`scope`ã§ã¯ã‚¢ãƒ—ãƒªã§ã§ãã‚‹ã“ã¨ã®ç¯„å›²ï¼ˆã‚¹ã‚³ãƒ¼ãƒ—ï¼‰ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»Šå›ã¯ Google ãƒ‰ãƒ©ã‚¤ãƒ–ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã•ã›ãŸã‹ã£ãŸã®ã§ã€https://www.googleapis.com/auth/drive.file ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã—ãŸã€‚
ãã®ä»–ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚³ãƒ¼ãƒ‰ã¯[ã“ã¡ã‚‰](https://developers.google.com/drive/api/guides/api-specific-auth?hl=ja)ã‚’å‚ç…§ãã ã•ã„ã€‚

`json_key_io`ã«ã¯äº‹å‰æº–å‚™ã§ç”¨æ„ã—ã¦ãŠã„ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã® JSON ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```ruby
drive = Google::Apis::DriveV3::DriveService.new
drive.authorization = authorizer

metadata = Google::Apis::DriveV3::File.new(name: 'sample.png', parents: ['Googleãƒ‰ãƒ©ã‚¤ãƒ–ã®ãƒ•ã‚©ãƒ«ãƒ€ID'])
drive.create_file(metadata, upload_source: './sample.png', content_type: 'image/png')
```

**REST client for Google APIs**ã®[Readme](https://github.com/googleapis/google-api-ruby-client#:~:text=for%20more%20information.-,Using%20the%20clients,-The%20client%20gems)ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

`Google::Apis::DriveV3::File.new()`ã®å¼•æ•°ã§ã€ä¿å­˜ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ï¼ˆnameï¼‰ã¨ä¿å­˜å…ˆã®ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆparentsï¼‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚

`create_file()`ã®å¼•æ•°ã§ã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆupload_sourceï¼‰ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ã‚¤ãƒ—ï¼ˆcontent_typeï¼‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚
å…±æœ‰ãƒ‰ãƒ©ã‚¤ãƒ–ã«ä¿å­˜ã™ã‚‹å ´åˆã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ã«`supports_team_drives: true`ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
