---
title: "個人的によく使う Heroku CLI コマンド"
emoji: "🤖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Heroku", "Rails"]
published: false
---

最近、Heroku を触りはじめたのでよく使うコマンドをまとめておきます。
Heroku では Rails アプリを公開しているため、一部 Rails のコマンドも出てきます。
また、複数のアプリを運用している環境で実行することが多いため、`-a`オプションを付けてアプリを指定の上コマンドを実行することが多いですが、今回の記事では省略しています。

## 環境

- Heroku: heroku/7.68.2 darwin-x64 node-v14.19.0

## よく使うコマンド

### ログイン

```shell
$ heroku login
```

### ログアウト

```shell
$ heroku logout
```

### ログの確認

デバッグする際に使よく使うコマンド

```shell
$ heroku logs
```

`-t`オプションをつけるとリアルタイムで最新のログを監視可能

```shell
$ heroku logs -t
```

### Heroku に入って bash を利用

```shell
$ heroku run bash
```

### Rake タスクの実行

```shell
$ heroku run rails users:create_user
```

## よく使わないコマンド

よく使わないけど備忘録も兼ねて残しておきます

### PRD 環境のデータをプレビュー環境に移行した際のコマンド

別のアプリのデータベースから直接データを転送
以下は GUI 上で実行（CLI でもできそう）

- 移行先のデータベース作成
- 移行元のバックアップ

```shell
# 移行元アプリの HEROKU_POSTGRESQL_ORANGE_URL データベースから移行先アプリの GREEN データベースにデータをコピー
$ heroku pg:copy 移行元のアプリ名::HEROKU_POSTGRESQL_ORANGE_URL GREEN -a 移行先のアプリ名

# 向き先を新しいデータベースに変更
$ heroku pg:promote GREEN -a 移行先のアプリ名

# 確認
$ heroku pg:info -a 移行先のアプリ名
```

※メンテナンスモードへの切り替えやワーカーの停止などは状況に応じて実行

参考
[Heroku PGBackups](https://devcenter.heroku.com/articles/heroku-postgres-backups)
[Managing Heroku Postgres using the CLI](https://devcenter.heroku.com/articles/managing-heroku-postgres-using-cli)
