---
title: "Railsã§ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†æ–¹æ³•"
emoji: "ğŸ·"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Rails", "Ruby"]
published: false
---

Rails ã§ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ‰±ã†ã¨ãã®å‚™å¿˜éŒ²ã§ã™ã€‚
ï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯è«¸èª¬ã‚ã‚Šãã†ãªã®ã§ï¼‰

## ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

```ruby
require 'uri'

def validate_email(email)
    return if email.blank? # 1
    format_email = email.gsub(/[[:space:]]/, '') # 2
    raise "error" unless URI::MailTo::EMAIL_REGEXP.match?(email) # 3
    format_email # 4
end
```

## å†…å®¹

validate_email ã®ä¸­ã§ã¯ä¸‹è¨˜ã®æµã‚Œã§å‡¦ç†ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

1. email ãŒç©ºã‹ã©ã†ã‹åˆ¤å®šã™ã‚‹
2. email ã«ã‚¹ãƒšãƒ¼ã‚¹ã¨æ”¹è¡ŒãŒå«ã¾ã‚Œã¦ã„ãŸå ´åˆã€å–ã‚Šé™¤ã
3. ï¼  ãŒå«ã¾ã‚Œã¦ã„ãªã„ãªã©ã€email ãŒå½¢å¼ã«ããã‚ãªã„å ´åˆã€ä¾‹å¤–ã§è¿”ã™
4. å½¢å¼ã«å•é¡Œãªã„å ´åˆã€2 ã§æ•´å½¢ã—ãŸ emailï¼ˆformat_emailï¼‰ ã‚’è¿”ã™

```ruby
raise "error" unless URI::MailTo::EMAIL_REGEXP.match?(email)
```

email ã®å½¢å¼ãƒã‚§ãƒƒã‚¯ã«ã¯ Ruby æ¨™æº–ã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹`URI::MailTo::EMAIL_REGEXP`ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚
[ä¸­èº«](https://github.com/ruby/ruby/blob/dafbaabc04e5a2d34045af78629a7249fd8c7481/lib/uri/mailto.rb#L55)ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€email ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£è¦è¡¨ç¾ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

```ruby
EMAIL_REGEXP = /\A[a-zA-Z0-9.!\#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\z/
```

## è£œè¶³

`URI::MailTo::EMAIL_REGEXP`ã§ã¯ RFC ã¨ç…§ã‚‰ã—åˆã‚ã›ãŸå ´åˆã€ä¸‹è¨˜ã®ä¾‹ã¯æ¼ã‚Œã‚‹ã‚ˆã†ãªã®ã§åˆ©ç”¨ã«ã‚ãŸã£ã¦ã¯è€ƒæ…®ãŒå¿…è¦ãã†ã§ã™ã€‚

ã‚¢ãƒƒãƒˆãƒãƒ¼ã‚¯ï¼ˆ@ï¼‰ã®ç›´å‰ã‚„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å…ˆé ­ã«ãƒ”ãƒªã‚ªãƒ‰ ï¼ˆ.ï¼‰ ãŒã‚ã‚‹

```text
hoge.@gmail.com
.hoge@gmail.com
```

ã‚¢ãƒƒãƒˆãƒãƒ¼ã‚¯ï¼ˆ@ï¼‰ã‚ˆã‚Šå‰ã§ã€ãƒ”ãƒªã‚ªãƒ‰ ï¼ˆ.ï¼‰ ãŒé€£ç¶šã—ã¦ã„ã‚‹

```text
ho..ge@gmail.com
```

é€†ã«[RFC5322](https://tex2e.github.io/rfc-translater/html/rfc5322.html#:~:text=3.2.4.%20Quoted%20Strings-,3.2.4.%20%E5%BC%95%E7%94%A8%E6%96%87%E5%AD%97%E5%88%97,-Strings%20of%20characters)ã§ã¯ã€@ã®å‰ã‚’å¼•ç”¨ç¬¦ã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãŸå ´åˆã€ä»»æ„ã®æ–‡å­—ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã‚ã‚Šã¾ã™ãŒã€`URI::MailTo::EMAIL_REGEXP`ã§ã¯ false ã«ãªã‚Šã¾ã™ã€‚

```text
"Hello @ World! "@gmail.com
```
