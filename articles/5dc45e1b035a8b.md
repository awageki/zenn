---
title: "Railsでメールアドレスのバリデーションを行う方法"
emoji: "🐷"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Rails", "Ruby"]
published: false
---

Rails でメールアドレスのバリデーションを実装してみたので、メモとして残しておきます。

## ソースコード

```ruby
require 'uri'

def validate_email(email)
    return if email.blank? # 1
    format_email = email.gsub(/[[:space:]]/, '') # 2
    raise "error" unless URI::MailTo::EMAIL_REGEXP.match?(email) # 3
    format_email # 4
end
```

## 内容

validate_email の中では下記の流れで処理を行っています。

1. email が空かどうか判定、空の場合
2. email にスペースと改行が含まれていた場合、取り除く
3. ＠ が含まれていないなど、email が形式にそぐわない場合、例外で返す
4. 形式に問題ない場合、2 で整形した状態の email を返す

```ruby
raise "error" unless URI::MailTo::EMAIL_REGEXP.match?(email)
```

email の形式チェックには Ruby 標準で用意されている`URI::MailTo::EMAIL_REGEXP`を使用しました。
中身を見てみると、email のバリデーションが正規表現で定義されています。
標準で準備されてるのありがたいです。
https://github.com/ruby/ruby/blob/dafbaabc04e5a2d34045af78629a7249fd8c7481/lib/uri/mailto.rb#L55
